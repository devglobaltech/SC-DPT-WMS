IF  EXISTS (SELECT * FROM SYS.OBJECTS WHERE OBJECT_ID = OBJECT_ID(N'[DBO].[MOB_ABRIR_EMPAQUE]') AND TYPE IN (N'P', N'PC'))
DROP PROCEDURE [DBO].[MOB_ABRIR_EMPAQUE]
GO

CREATE PROCEDURE [dbo].[MOB_ABRIR_EMPAQUE]
(
	 @CLIENTE_ID	VARCHAR(15)		OUTPUT
	,@VIAJE_ID		VARCHAR(100)	OUTPUT
	,@CONTENEDOR	VARCHAR(100)	OUTPUT
)
AS
BEGIN
	--[VERIFICAR_EMPAQUE_INFORMADO_ERP]

	IF EXISTS
	(	SELECT	1 
		FROM	INFORME_PEDIDOS_EMPAQUE_ERP
		WHERE	CLIENTE_ID = @CLIENTE_ID AND VIAJE_ID = @VIAJE_ID)BEGIN
		
		RAISERROR('EL PEDIDO YA SE ENCUENTRA INFORMADO. NO ES POSIBLE ABRIR LA CONTENEDORA',16,1)
	END

	UPDATE	MOB_EMPAQUE_UC_EMPAQUE SET ESTADO='ABIERTO' 
	FROM	MOB_EMPAQUE_UC_EMPAQUE M INNER JOIN DOCUMENTO D	ON(M.DOCUMENTO_ID=D.DOCUMENTO_ID)
			INNER JOIN PICKING P							ON(P.DOCUMENTO_ID=D.DOCUMENTO_ID)
	WHERE	P.CLIENTE_ID=@CLIENTE_ID
			AND P.VIAJE_ID=@VIAJE_ID
			AND M.UC_EMPAQUE=@CONTENEDOR
END


