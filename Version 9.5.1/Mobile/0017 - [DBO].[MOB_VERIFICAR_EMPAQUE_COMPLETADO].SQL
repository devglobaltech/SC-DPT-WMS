/****** OBJECT:  STOREDPROCEDURE [DBO].[MOB_VERIFICAR_EMPAQUE_COMPLETADO]    SCRIPT DATE: 22/08/2015 12:18:45 ******/
DROP PROCEDURE [DBO].[MOB_VERIFICAR_EMPAQUE_COMPLETADO]
GO

CREATE PROCEDURE [DBO].[MOB_VERIFICAR_EMPAQUE_COMPLETADO]
(
	 @CLIENTE_ID		VARCHAR(15)		OUTPUT
	,@VIAJE_ID		VARCHAR(100)	OUTPUT
	,@RESULTADO		INT				OUTPUT
)
AS
BEGIN
	DECLARE @CANT_EMPAQUE	AS NUMERIC(20,0)
	DECLARE @CANT_PICKING	AS NUMERIC(20,0)
	DECLARE @CANT_EMP_PIC	AS NUMERIC(20,0)
	DECLARE @RES			AS NUMERIC(20,0)

	SELECT @CANT_EMPAQUE=SUM(CANT_CONFIRMADA) FROM TMP_EMPAQUE_CONTENEDORA WHERE CLIENTE_ID=@CLIENTE_ID AND VIAJE_ID=@VIAJE_ID AND ISNULL(PALLET_CONTROLADO,'0')='1'

	SELECT @CANT_EMP_PIC=SUM(CANT_CONFIRMADA) FROM PICKING WHERE CLIENTE_ID=@CLIENTE_ID AND VIAJE_ID=@VIAJE_ID AND ISNULL(PALLET_CONTROLADO,'0')='1'

	SET @RES=ISNULL(@CANT_EMPAQUE,0) + ISNULL(@CANT_EMP_PIC,0)

	SELECT @CANT_PICKING=SUM(CANT_CONFIRMADA) FROM PICKING WHERE CLIENTE_ID=@CLIENTE_ID AND VIAJE_ID=@VIAJE_ID

	IF @RES=@CANT_PICKING BEGIN
		SET @RESULTADO='1'
	END
	ELSE BEGIN
		IF @RES>@CANT_PICKING BEGIN
			SET @RESULTADO='1'
		END ELSE BEGIN
			SET @RESULTADO='0'
		END
	END

END
