/****** Object:  StoredProcedure [dbo].[SP_SENDMAIL]    Script Date: 03/14/2013 15:43:46 ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SP_SENDMAIL]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[SP_SENDMAIL]
GO
CREATE PROCEDURE DBO.SP_SENDMAIL
  @CUERPO       VARCHAR(4000),
  @PROCESO      VARCHAR(100),
  @SUB_PROCESO  VARCHAR(100)
AS
BEGIN
  
  DECLARE @LIST VARCHAR(4000);
  DECLARE @SUB  VARCHAR(100);
  DECLARE @INST VARCHAR(100);
  
  SELECT @LIST=VALOR FROM SYS_PARAMETRO_PROCESO WHERE PROCESO_ID=@PROCESO AND SUBPROCESO_ID=@SUB_PROCESO AND PARAMETRO_ID='TO';
  SELECT @SUB=VALOR FROM SYS_PARAMETRO_PROCESO WHERE PROCESO_ID=@PROCESO AND SUBPROCESO_ID=@SUB_PROCESO AND PARAMETRO_ID='SUBJECT';
  SELECT @INST=VALOR FROM SYS_PARAMETRO_PROCESO WHERE PROCESO_ID=@PROCESO AND SUBPROCESO_ID=@SUB_PROCESO AND PARAMETRO_ID='INSTALACION';
  
  SET @SUB=@SUB + ' ' + @INST;
  
  EXEC  msdb.dbo.sp_send_dbmail @recipients = @LIST, @body = @CUERPO, @subject = @SUB;      
            
END;